<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Fleet</title>
    <script>window.$ = window.jQuery = require('./scripts/jquery-3.0.0.js');</script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="./style.css">

    <script>
     (function() {
         if (!process.env.HOT) {
             const link = document.createElement('link');
             link.rel = 'stylesheet';
             link.href = '../dist/style.css';
             document.write(link.outerHTML);
         }
     }());
    </script>

    <style>
     html {
         box-sizing: border-box;
     }
     *, *:before, *:after {
         box-sizing: inherit;
     }
     body {
         margin: 0;
         padding: 0;
         height: 100vh;
         /* font-family: 'Helvetica Neue', 'Avenir Next', Verdana, sans-serif; */
     }
    </style>
  </head>
  <body>
    <div id="overlay" class="loader-wrapper">
      <div class="loader"></div>
    </div>

    <div id="fleet"></div>

    <script>
     (function() {
         const script = document.createElement('script');
         script.src = (process.env.HOT) ? 'http://localhost:3000/dist/bundle.js' : '../dist/bundle.js';
         document.write(script.outerHTML);
     }());
    </script>

    <script>
     onload = () => {
         require('electron-cookies');
         var ipc = require("ipc");
         var IPCStream = require('electron-ipc-stream');
         var ipcs = new IPCStream('file');

         const webview = document.getElementById('game');
         webview.addEventListener('console-message', function(e) {
             console.log('Guest page logged a message:', e.message);
         });

         webview.addEventListener("ipc-message", function (e) {
             console.log(e);
             webview.loadURL(e.args[0]);
         });

         const overlay = document.getElementById("overlay");

         const loadstart = () => {
             overlay.style.display = 'block';
         };

         var did = false;

         const loadstop = () => {
             overlay.style.display = 'none';
             webview.insertCSS("#sectionWrap{ visibility:hidden; }")
             webview.insertCSS("#spacing_top{ display:none; }")
             webview.insertCSS("#flashWrap{ overflow:hidden; margin:0; }")
             webview.insertCSS("body{ overflow:hidden; margin:0; }")
             if (!did && webview.getTitle().indexOf("艦隊これくしょん -艦これ- - オンラインゲーム - DMM.com") > -1) {
                 did = true;
                 webview.send('ping');
             }
         };

         webview.addEventListener('did-start-loading', loadstart);
         webview.addEventListener('did-stop-loading', loadstop);
     };
    </script>

  </body>
</html>
